# Build instructions for Microwatt

TODO integrate from <https://libre-soc.org/irclog/%23libre-soc.2022-01-26.log.html>

After installing ghdl-yosys-plugin use schroot to switch environment

    schroot -c bullseye_ghdl
    git clone https://git.libre-soc.org/git/microwatt.git
    git checkout verilator_trace
    export FPGA_TARGET=verilator
    make microwatt-verilator

Then run the resulting binary

    time ./microwatt-verilator

If everything works correcly it will print out an light bulb in ascii art
with the message Microwatt, it works. On my ASUS KGPE D16 this takes

     real	1m4.986s
     user	1m4.373s
     sys	0m0.013s
     
## Building the kernel
On a POWER9 there is no need to install gcc-powerpc64le-linux-gnu, 
you can omit CROSS_COMPILE and ARCH in this case

	apt install gcc-powerpc64le-linux-gnu
	apt install flex bison lz4
	git clone -b microwatt-5.7 https://git.kernel.org/pub/scm/linux/kernel/git/joel/microwatt.git
	cd microwatt
	wget http://ftp.libre-soc.org/rootfs.cpio
	CROSS_COMPILE="ccache powerpc64le-linux-gnu-" ARCH=powerpc make -j8 O=microwatt microwatt_defconfig
	CROSS_COMPILE="ccache powerpc64le-linux-gnu-" ARCH=powerpc make -j8 O=microwatt
	
This will produce a file 
	microwatt/arch/powerpc/boot/dtbImage.microwatt
