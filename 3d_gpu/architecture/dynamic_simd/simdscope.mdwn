# SimdScope

Links:

* <https://bugs.libre-soc.org/show_bug.cgi?id=734>

TODO

SimdScope is the user-facing "front" behind which SimdSignal
is entirely and transparently hidden.  Aside from using it,
the goal and its purpose is that
developers should under no circumstances have to know
that their HDL, which was initially written as scalar
nmigen HDL, is behaving entirely transparently as full
SIMD capable HDL.  There are a few caveats to that: some
capabilities such as LHS assignment to an ast.Part are so
complex in a SIMD context that SimdSignal in its first
version does not implement it.  Array is out at the moment
as well.  Over time this may change.

SimdScope is used as follows:

    m = Module()
    elwid = Signal(2)
    vec_el_counts = { 0b00: 64, 0b01: 32, 0b10: 16, 0b11: 8}
    with SimdScope(m, elwid, vec_el_counts, scalar=pspec.scalar) as s:
        a = s.Signal(64)
        b = s.Signal(32)

    with m.If(a > Const(2)):
        m.d.comb += b.eq(a[:32])

Note that the scalar parameter is selected from a runtime/compiletime
configuration parameter which can alter the context between scalar and
SIMD.

When set to scalar, SimdScope.Signal simply re-routes directly
to nmigen.ast.Signal and in this way sets the mandatory expectation
that **under no circumstances** shall SimdScope or SimdSignal alter
the fundamental language behavioural characteristics of Type 1 (AST)
or Type 2 (dsl.Module)
        
